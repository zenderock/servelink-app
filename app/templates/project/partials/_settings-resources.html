<form method="post"
  action="{{ url_for('project_settings', team_slug=team.slug, project_name=project.name).include_query_params(fragment='resources') }}"
  hx-post="{{ url_for('project_settings', team_slug=team.slug, project_name=project.name).include_query_params(fragment='resources') }}"
  hx-swap="outerHTML" x-data="{ changed: false }"
  hx-on::before-request="document.activeElement && document.activeElement.blur()" @input="changed = true"
  @change="changed = true" hx-indicator="next .htmx-indicator" class="card">
  {{ resources_form.csrf_token(id=False) }}
  <header class="border-b">
    <h2>{{ _('Resources') }}</h2>
    <p>{{ _('Configuration for the compute resources allocated to each deployment.') }}</p>
  </header>

  <section class="space-y-6">
    {{ resources_form.csrf_token(id=False) }}
    <div class="space-y-3">
      {{ resources_form.cpus.label() }}
      <div class="flex items-center justify-between text-sm text-muted-foreground mb-2">
        <span>Plan limit: {{ team.current_plan.max_cpu_cores }} cores</span>
        <span>Default: {{ team.current_plan.default_cpu_cores }} cores</span>
      </div>
      <div class="flex items-center gap-x-2" x-data="{ cpus: '{{ resources_form.cpus.data or '' }}' }">
        {{ resources_form.cpus(
        id=False,
        class="w-full",
        placeholder=team.current_plan.default_cpu_cores,
        min=0.1,
        max=team.current_plan.max_cpu_cores,
        step=0.1,
        **{'x-model': 'cpus'}
        ) }}
        <button type="button" class="btn-ghost" data-tooltip="{{ _('Use default') }}" :disabled="cpus == ''"
          @click="cpus = ''; $dispatch('change')">
          {% include "icons/x.svg" %}
        </button>
      </div>
      <p class="text-sm text-muted-foreground">
        {{ _('Number of CPU cores to allocate (empty = use defaults, 0 = no limit, supports decimals like 0.5)') }}
      </p>
      {% for error in resources_form.cpus.errors %}
      <p class="text-destructive text-sm">{{ error }}</p>
      {% endfor %}
    </div>
    <div class="space-y-3">
      {{ resources_form.memory.label() }}
      {% if team.current_plan.name == 'pay_as_you_go' %}
      <div class="flex items-center justify-between text-sm text-muted-foreground mb-2">
        <span>Available: {{ available_memory }}MB</span>
        <span>Default: {{ team.current_plan.default_memory_mb }}MB</span>
      </div>
      {% else %}
      <div class="flex items-center justify-between text-sm text-muted-foreground mb-2">
        <span>Plan limit: {{ team.current_plan.max_memory_mb }}MB</span>
        <span>Default: {{ team.current_plan.default_memory_mb }}MB</span>
      </div>
      {% endif %}
      <div class="flex items-center gap-x-2" x-data="{ memory: '{{ resources_form.memory.data or '' }}' }">
        {{ resources_form.memory(
        id=False,
        class="w-full",
        placeholder=team.current_plan.default_memory_mb,
        min=1,
        max=team.current_plan.max_memory_mb,
        **{'x-model': 'memory'}
        ) }}
        <button type="button" class="btn-ghost" data-tooltip="{{ _('Use default') }}" :disabled="memory == ''"
          @click="memory = ''; $dispatch('change')">
          {% include "icons/x.svg" %}
        </button>
      </div>
      <p class="text-sm text-muted-foreground">
        {{ _('Memory limit in megabytes (empty = use defaults, 0 = no limit, max 256GB)') }}
      </p>
      {% for error in resources_form.memory.errors %}
      <p class="text-destructive text-sm">{{ error }}</p>
      {% endfor %}
    </div>
  </section>

  <footer class="flex justify-end gap-x-2">
    <button type="button" class="btn-sm-ghost"
      hx-get="{{ url_for('project_settings', team_slug=team.slug, project_name=project.name).include_query_params(fragment='resources') }}"
      hx-target="closest form" hx-swap="outerHTML" :disabled="!changed">{{ _('Cancel') }}</button>
    <button class="btn-sm" :disabled="!changed">{{ _('Save') }}</button>
  </footer>
</form>

<div class="htmx-indicator flex items-center justify-center inset-0 absolute bg-background/80 rounded-xl">
  <div class="flex items-center gap-x-2 text-muted-foreground [&>svg]:size-4 [&>svg]:animate-spin">
    {% include "icons/loader.svg" %}
    {{ _('Saving') }}
  </div>
</div>