<div class="card">
    <header class="border-b">
        <h2>{{ _("Usage & Limits") }}</h2>
        <p class="text-muted-foreground">{{ _("Monitor your monthly usage and limits") }}</p>
    </header>

    <div class="space-y-6">
        {% if usage_summary %}
        <!-- Current Month Usage -->
        <div class="space-y-4 px-4 py-3">
            <h3 class="font-medium">{{ _("Current Month") }}</h3>

            <!-- Traffic Usage -->
            <div class="space-y-2">
                <div class="flex items-center justify-between text-sm">
                    <span>{{ _("Network Traffic") }}</span>
                    <span class="text-muted-foreground">
                        {{ usage_summary.usage.traffic_gb|round(2) }} GB
                        {% if usage_summary.plan.max_traffic_gb > 0 %}
                        / {{ usage_summary.plan.max_traffic_gb }} GB
                        {% endif %}
                    </span>
                </div>
                {% if usage_summary.plan.max_traffic_gb > 0 %}
                <div class="w-full bg-muted rounded-full h-2">
                    <div class="h-2 rounded-full transition-all duration-300
                        {% if usage_summary.limits.traffic.percentage >= 95 %}
                            bg-destructive
                        {% elif usage_summary.limits.traffic.percentage >= 80 %}
                            bg-warning
                        {% else %}
                            bg-primary
                        {% endif %}"
                        style="width: {{ usage_summary.limits.traffic.percentage|min(100) }}%"></div>
                </div>
                <div class="text-xs text-muted-foreground">
                    {{ usage_summary.limits.traffic.percentage|round(1) }}% utilisé
                </div>
                {% endif %}
            </div>

            <!-- Storage Usage -->
            <div class="space-y-2">
                <div class="flex items-center justify-between text-sm">
                    <span>{{ _("Storage") }}</span>
                    <span class="text-muted-foreground">
                        {{ usage_summary.usage.storage_mb|round(2) }} MB
                        {% if usage_summary.plan.max_storage_mb > 0 %}
                        / {{ usage_summary.plan.max_storage_mb }} MB
                        {% endif %}
                    </span>
                </div>
                {% if usage_summary.plan.max_storage_mb > 0 %}
                <div class="w-full bg-muted rounded-full h-2">
                    <div class="h-2 rounded-full transition-all duration-300
                        {% if usage_summary.limits.storage.percentage >= 95 %}
                            bg-destructive
                        {% elif usage_summary.limits.storage.percentage >= 80 %}
                            bg-warning
                        {% else %}
                            bg-primary
                        {% endif %}"
                        style="width: {{ usage_summary.limits.storage.percentage|min(100) }}%"></div>
                </div>
                <div class="text-xs text-muted-foreground">
                    {{ usage_summary.limits.storage.percentage|round(1) }}% utilisé
                </div>
                {% endif %}
            </div>

            <!-- Warnings -->
            {% if usage_summary.limits.traffic.percentage >= 80 or usage_summary.limits.storage.percentage >= 80 %}
            <div class="p-4 rounded-lg border
                {% if usage_summary.limits.traffic.percentage >= 95 or usage_summary.limits.storage.percentage >= 95 %}
                    border-destructive bg-destructive/10
                {% else %}
                    border-warning bg-warning/10
                {% endif %}">
                <div class="flex items-start gap-3">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mt-0.5">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <div class="flex-1">
                        <div class="font-medium">{{ _("Usage Alert") }}</div>
                        <div class="text-sm text-muted-foreground mt-1">
                            {% if usage_summary.limits.traffic.percentage >= 95 or usage_summary.limits.storage.percentage >= 95 %}
                                {{ _("You've reached 95% of your plan limits. Consider upgrading to avoid service interruption.") }}
                            {% else %}
                                {{ _("You've reached 80% of your plan limits. Monitor your usage to avoid exceeding limits.") }}
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        {% else %}
        <div class="px-4 py-8 text-center text-muted-foreground">
            <p>{{ _("No usage data available for this month") }}</p>
        </div>
        {% endif %}

        <!-- Upgrade Button -->
        {% if team.current_plan.name == 'free' %}
        <div class="pt-4 border-t px-4">
            <button type="button" 
                    onclick="document.getElementById('pricing-modal').style.display='flex'"
                    class="btn-primary">
                {{ _("Upgrade for More Resources") }}
            </button>
            <p class="text-xs text-muted-foreground mt-2">
                {{ _("Get 10GB traffic, 10GB storage, and more with the Pro plan") }}
            </p>
        </div>
        {% endif %}
    </div>
</div>
