<div class="card">
    <header class="border-b">
        <h2>{{ _("Payments") }}</h2>
        <p class="text-muted-foreground">{{ _("Manage your payment methods and billing history") }}</p>
    </header>

    <div class="space-y-6">
        <!-- Upgrade to Pro -->
        {% if team.current_plan.name == 'free' %}
        <div class="px-4 py-6 bg-primary/5 border border-primary/20 rounded-lg">
            <div class="flex items-start gap-4">
                <div class="flex-shrink-0">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                </div>
                <div class="flex-1">
                    <h3 class="font-medium mb-2">{{ _("Upgrade to Pro Plan") }}</h3>
                    <p class="text-sm text-muted-foreground mb-4">
                        {{ _("Unlock unlimited teams, projects, custom domains and more for only 3€/month") }}
                    </p>
                    
                    <!-- Payment Method Selection -->
                    <div class="space-y-3">
                        <div class="text-sm font-medium">{{ _("Choose payment method:") }}</div>
                        
                        <button type="button" 
                                class="btn-secondary w-full opacity-50 cursor-not-allowed"
                                disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                            {{ _("Mobile Money (Coming Soon)") }}
                        </button>
                        
                        <button type="button" 
                                class="btn-secondary w-full opacity-50 cursor-not-allowed"
                                disabled>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="mr-2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                            {{ _("Credit Card (Coming Soon)") }}
                        </button>
                        
                        <p class="text-xs text-muted-foreground text-center">
                            {{ _("Payment processing will be available soon. Stay tuned!") }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Payment History -->
        <div class="px-4">
            <h3 class="font-medium mb-4">{{ _("Payment History") }}</h3>
            
            {% if payment_history and payment_history|length > 0 %}
            <div class="space-y-2">
                {% for payment in payment_history %}
                <div class="flex items-center justify-between p-3 border rounded-lg">
                    <div class="flex items-center gap-3">
                        <div class="flex-shrink-0">
                            {% if payment.status == 'completed' %}
                            <div class="w-2 h-2 rounded-full bg-green-500"></div>
                            {% elif payment.status == 'failed' %}
                            <div class="w-2 h-2 rounded-full bg-destructive"></div>
                            {% elif payment.status == 'cancelled' %}
                            <div class="w-2 h-2 rounded-full bg-muted"></div>
                            {% else %}
                            <div class="w-2 h-2 rounded-full bg-warning animate-pulse"></div>
                            {% endif %}
                        </div>
                        <div>
                            <div class="font-medium">
                                {{ payment.metadata.get('description', 'Payment') }}
                            </div>
                            <div class="text-sm text-muted-foreground">
                                {{ payment.created_at.strftime('%d %b %Y %H:%M') }}
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-medium">{{ payment.amount }}€</div>
                        <div class="text-xs px-2 py-1 rounded-full inline-block
                            {% if payment.status == 'completed' %}
                                bg-green-100 text-green-700
                            {% elif payment.status == 'failed' %}
                                bg-destructive/10 text-destructive
                            {% elif payment.status == 'cancelled' %}
                                bg-muted text-muted-foreground
                            {% else %}
                                bg-warning/10 text-warning
                            {% endif %}">
                            {{ payment.status|capitalize }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="py-8 text-center text-muted-foreground">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="mx-auto mb-3 opacity-50">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                    <line x1="1" y1="10" x2="23" y2="10"/>
                </svg>
                <p>{{ _("No payment history yet") }}</p>
                <p class="text-sm mt-1">{{ _("Your payments will appear here") }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Fonction pour initier un paiement (à compléter quand le backend sera prêt)
async function initiatePayment(paymentMethod) {
    try {
        const response = await fetch('/api/payments/{{ team.slug }}/initiate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                amount: 3.0,
                payment_method: paymentMethod,
                plan_upgrade: true,
                new_plan: 'pay_as_you_go',
                description: 'Upgrade to Pro plan'
            })
        });
        
        const data = await response.json();
        
        if (response.ok && data.payment_url) {
            // Rediriger vers la page de paiement
            window.location.href = data.payment_url;
        } else {
            alert('Error initiating payment');
        }
    } catch (error) {
        console.error('Payment error:', error);
        alert('Error initiating payment');
    }
}
</script>
