{% from "macros/dropdown-menu.html" import dropdown_menu %}
{% from "macros/avatar.html" import avatar with context %}
{% from "macros/dialog.html" import dialog %}
{% call dialog(
title=_("New team"),
description=_("Create a new team to manage your projects."),
id="dialog-new-team",
trigger_attrs={"role": "menuitem"},
dialog_attrs={"class": "w-full max-w-xl"},
body_attrs={"class": "space-y-4"}
) %}
<div hx-get="{{ url_for('new_team') }}" hx-trigger="toggle from:closest dialog once" class="min-h-[114px] relative">
	<div class="htmx-indicator flex items-center justify-center inset-0 absolute bg-background/80">
		<div class="flex items-center gap-x-2 text-muted-foreground [&>svg]:size-4 [&>svg]:animate-spin">
			{% include "icons/loader.svg" %}
			{{ _('Saving') }}
		</div>
	</div>
</div>
{% endcall %}
{% set trigger %}{% include "icons/chevrons-up-down.svg" %}{% endset %}
<header class="sticky top-0 bg-background z-20 border-b px-8 flex flex-col gap-y-2">
	<div class="flex items-center justify-between gap-x-4 h-16">
		<nav class="flex items-center gap-x-1.5 sm:gap-x-2.5">
			<a href="/" class="w-8 h-8 shrink-0 flex items-center justify-center" aria-label="{{ app_name }}"
				x-boost="true">
				<img src="{{ url_for('assets', path='/logo.svg') }}" alt="{{ app_name }}" class="w-8 h-8" />
			</a>

			{% if current_user %}
			{% if team %}
			<div class="text-muted-foreground/25 text-xl">/</div>
			<div class="flex items-center">
				<a href="{{ url_for('team_index', team_slug=team.slug) }}"
					class="btn-sm-ghost pl-2 {% if project or deployment %}pr-2{% endif %}" hx-boost="true">
					{{ avatar(item=team, prefix="team", name=team.name, size="xs") }}
					<span {% if project or deployment %}class="max-sm:hidden" {% endif %}>{{ team.name }}</span>
					{% if team.current_plan %}
					<span class="ml-1 px-1.5 py-0.5 text-xs font-medium rounded-none
						{% if team.current_plan.name == 'free' %}
							bg-muted text-muted-foreground
						{% else %}
							bg-primary/10 text-primary
						{% endif %}">
						{{ team.current_plan.display_name }}
					</span>
					{% else %}
					<span class="ml-1 px-1.5 py-0.5 text-xs font-medium rounded-none bg-muted text-muted-foreground">
						Free
					</span>
					{% endif %}
				</a>
				{% call dropdown_menu(
				trigger=trigger,
				trigger_attrs={"class": "btn-sm-ghost border-0 border-none text-muted-foreground w-6"},
				popover_attrs={"data-align": "start"}
				) %}
				{% include "partials/_menu-teams.html" %}
				{% endcall %}
			</div>
			{% endif %}

			{% if project %}
			<div class="text-muted-foreground/25 text-xl">/</div>

			<div class="flex items-center">
				<a href="{{ url_for('project_index', team_slug=team.slug, project_name=project.name) }}"
					class="btn-sm-ghost pl-2 {% if deployment %}pr-2{% endif %}" hx-boost="true">
					{% from "macros/avatar.html" import avatar with context %}
					{{ avatar(item=project, prefix="project", name=project.name, size="xs") }}
					<span {% if deployment %}class="max-sm:hidden" {% endif %}>{{ project.name }}</span>
				</a>
				{% call dropdown_menu(
				trigger=trigger,
				trigger_attrs={"class": "btn-sm-ghost border-0 border-none text-muted-foreground w-6"},
				popover_attrs={"data-align": "start"}
				) %}
				{% include "partials/_menu-projects.html" %}
				{% endcall %}
			</div>
			{% endif %}

			{% if deployment %}
			<div class="text-muted-foreground/25 text-xl">/</div>

			<div class="flex items-center">
				<a href="{{ url_for('project_deployment', team_slug=team.slug, project_name=project.name, deployment_id=deployment.id) }}"
					class="btn-sm-ghost" hx-boost="true">
					{% from "deployment/macros/status.html" import status %}
					{{ status(
					conclusion=deployment.conclusion,
					compact=True,
					attrs={ 'data-deployment-status': deployment.id }
					) }}
					<span class="font-mono text-[13px]">{{ deployment.id[:7] }}</span>
				</a>
				{% call dropdown_menu(
				trigger=trigger,
				trigger_attrs={"class": "btn-sm-ghost border-0 border-none text-muted-foreground w-6"},
				popover_attrs={"data-align": "start"}
				) %}
				{% include "partials/_menu-deployments.html" %}
				{% endcall %}
			</div>

			<div hx-ext="sse" sse-connect="{{ url_for('project_event', team_id=team.id, project_id=project.id) }}"
				sse-close="sse:stream_closed">
				<div sse-swap="deployment_status_update"></div>
			</div>
			{% endif %}
			{% endif %}
		</nav>

		<nav class="flex items-center gap-x-2" aria-label="User menu">
			{% if current_user and current_user.default_team and current_user.default_team.current_plan and
			current_user.default_team.current_plan.name == 'free' %}
			<button type="button" onclick="document.getElementById('pricing-modal').style.display='flex'"
				class="btn-sm-outline text-primary border-primary hover:bg-primary hover:text-primary-foreground max-sm:hidden">
				{% include "icons/arrow-up-from-line.svg" %}
				Upgrade to Pro
			</button>
			{% endif %}
			{% set trigger %}
			{% include "icons/circle-question-mark.svg" %}
			{% endset %}
			{% call dropdown_menu(
			trigger=trigger,
			trigger_attrs={"class": "btn-sm-icon-ghost rounded-full max-sm:hidden"},
			popover_attrs={"data-align": "end"}
			) %}
			<a href="https://changelog.servel.ink/" target="_blank" role="menuitem">
				{{ _('Changelog') }}
				<span class="ml-auto text-muted-foreground [&>svg]:size-3">
					{% include "icons/external-link.svg" %}
				</span>
			</a>
			{% endcall %}
			{% if current_user %}
			<div hx-get="{{ url_for('user_notifications') }}" hx-trigger="load" hx-swap="outerHTML">
				{% from "user/macros/notifications.html" import notifications with context %}
				{{ notifications() }}
			</div>
			{% set trigger %}
			{% set fallback %}
			<img src="https://api.dicebear.com/7.x/avataaars/svg?seed={{ current_user.email }}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf&size=32"
				alt="{{ current_user.email }}" class="size-8 rounded-none shrink-0">
			{% endset %}
			{{ avatar(item=current_user, prefix="user", name=current_user.name if current_user.name else
			current_user.username, class="!rounded-none", fallback=fallback) }}
			{% endset %}
			{% call dropdown_menu(
			trigger=trigger,
			trigger_attrs={"class": "btn-icon-sm-ghost rounded-full shrink-0 p-0 border-0"},
			popover_attrs={"data-align": "end"}
			) %}
			<header class="px-2.5 py-1.5">
				<div class="font-medium">{{ current_user.name if current_user.name else current_user.username }}</div>
				<div class="text-muted-foreground">{{ current_user.email }}</div>
			</header>
			<hr role="separator" />
			<a href="{{ url_for('user_settings') }}" role="menuitem" hx-boost="true">{{ _('Account settings') }}</a>
			<a href="/" role="menuitem" hx-boost="true">{{ _('Default team') }}</a>
			<hr role="separator" />
			<button type="button" role="menuitem" onclick="document.dispatchEvent(new CustomEvent('basecoat:theme'))">
				<span class="hidden dark:block">{{ _('Theme: Light') }}</span>
				<span class="block dark:hidden">{{ _('Theme: Dark') }}</span>
				<span class="hidden dark:block ml-auto text-muted-foreground">{% include "icons/sun.svg" %}</span>
				<span class="block dark:hidden ml-auto text-muted-foreground">{% include "icons/moon.svg" %}</span>
			</button>

			<hr role="separator" class="sm:hidden" />

			<a href="https://changelog.servel.ink/" target="_blank" role="menuitem" class="sm:hidden">
				{{ _('Change Log') }}
				<span class="ml-auto text-muted-foreground [&>svg]:size-3">
					{% include "icons/external-link.svg" %}
				</span>
			</a>

			<hr role="separator" />
			<a href="{{ url_for('auth_logout') }}" role="menuitem">
				{{ _('Sign out') }}
			</a>
			{% endcall %}
			{% endif %}
		</nav>
	</div>

	{% if request.scope["route"].name.startswith("project_") %}
	{% include "partials/_tabs-project.html" %}
	{% endif %}
	{% if request.scope["route"].name.startswith("team_") %}
	{% include "partials/_tabs-team.html" %}
	{% endif %}
</header>

<div id="pricing-modal"
	style="display: none; position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center; padding: 16px;"
	onclick="if(event.target === this) this.style.display='none'">
	<div style="background-color: white; border-radius: 12px; max-width: 1200px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);"
		onclick="event.stopPropagation()">
		<button type="button" onclick="document.getElementById('pricing-modal').style.display='none'"
			style="position: absolute; top: 16px; right: 16px; width: 32px; height: 32px; border-radius: 6px; border: none; background-color: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s;"
			onmouseover="this.style.backgroundColor='rgba(0,0,0,0.05)'"
			onmouseout="this.style.backgroundColor='transparent'">
			<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
				stroke-linecap="round" stroke-linejoin="round">
				<line x1="18" y1="6" x2="6" y2="18"></line>
				<line x1="6" y1="6" x2="18" y2="18"></line>
			</svg>
		</button>

		<div style="padding: 48px 32px;">
			<div style="text-align: center; margin-bottom: 48px;">
				<h2 style="font-size: 36px; font-weight: 700; margin-bottom: 12px; color: #0f172a;">Simple, Transparent Pricing</h2>
				<p style="font-size: 18px; color: #64748b;">Choose the perfect plan for your deployment needs</p>
			</div>

			<div
				style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; max-width: 800px; margin: 0 auto;">
				<div style="border: 2px solid #e2e8f0; border-radius: 12px; padding: 32px; background-color: #ffffff; transition: transform 0.2s, box-shadow 0.2s;"
					onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px -4px rgba(0, 0, 0, 0.1)'"
					onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
					<div style="margin-bottom: 24px;">
						<h3 style="font-size: 24px; font-weight: 600; margin-bottom: 8px; color: #0f172a;">Free Plan</h3>
						<div style="display: flex; align-items: baseline; margin-bottom: 16px;">
							<span style="font-size: 48px; font-weight: 700; color: #0f172a;">0€</span>
						</div>
						<p style="color: #64748b; font-size: 14px;">Perfect for getting started</p>
					</div>

					<ul style="list-style: none; padding: 0; margin: 0 0 32px 0;">
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">1 Team</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">1 Member</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">2 Projects</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">500 MB Memory</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">0.25 CPU</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Basic support</span>
						</li>
					</ul>

					<button type="button" disabled
						style="width: 100%; padding: 12px 24px; border-radius: 8px; border: 2px solid #e2e8f0; background-color: #f8fafc; color: #94a3b8; font-weight: 600; font-size: 16px; cursor: not-allowed;">
						Current plan
					</button>
				</div>

				<div style="border: 2px solid #3b82f6; border-radius: 12px; padding: 32px; background-color: #ffffff; position: relative; transition: transform 0.2s, box-shadow 0.2s;"
					onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 24px -4px rgba(59, 130, 246, 0.3)'"
					onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
					<div
						style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background-color: #3b82f6; color: white; padding: 4px 16px; border-radius: 20px; font-size: 12px; font-weight: 600;">
						Most Popular
					</div>

					<div style="margin-bottom: 24px;">
						<h3 style="font-size: 24px; font-weight: 600; margin-bottom: 8px; color: #0f172a;">Pro Plan</h3>
						<div style="display: flex; align-items: baseline; margin-bottom: 16px;">
							<span style="font-size: 48px; font-weight: 700; color: #3b82f6;">3€</span>
							<span style="font-size: 16px; color: #64748b; margin-left: 8px;">/mois</span>
						</div>
						<p style="color: #64748b; font-size: 14px;">Everything you need to scale</p>
					</div>

					<ul style="list-style: none; padding: 0; margin: 0 0 32px 0;">
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Unlimited Teams</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Unlimited Members</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Unlimited Projects</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Up to 4GB Memory</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Up to 2 CPU</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Custom domains</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Priority support</span>
						</li>
						<li style="display: flex; align-items: flex-start; margin-bottom: 12px;">
							<svg style="width: 20px; height: 20px; color: #10b981; margin-right: 12px; flex-shrink: 0; margin-top: 2px;"
								fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M5 13l4 4L19 7"></path>
							</svg>
							<span style="color: #475569; font-size: 15px;">Advanced analytics</span>
						</li>
					</ul>

					<div style="display: flex; flex-direction: column; gap: 12px;">
						<a href="https://pay.mesomb.com/l/40h8eFwUX9rb3Rr4t7Bq" target="_blank" style="width: 100%; padding: 12px 24px; border-radius: 8px; border: none; background-color: #3b82f6; color: white; font-weight: 600; font-size: 16px; cursor: pointer; transition: background-color 0.2s; text-align: center; text-decoration: none; display: block;" onmouseover="this.style.backgroundColor='#2563eb'" onmouseout="this.style.backgroundColor='#3b82f6'">
							Pay with Mobile Money
						</a>
						<a href="https://lemonsqueezy.servel.ink/checkout" target="_blank" style="width: 100%; padding: 12px 24px; border-radius: 8px; border: 2px solid #3b82f6; background-color: transparent; color: #3b82f6; font-weight: 600; font-size: 16px; cursor: pointer; transition: all 0.2s; text-align: center; text-decoration: none; display: block;" onmouseover="this.style.backgroundColor='#3b82f6'; this.style.color='white'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#3b82f6'">
							Pay with Card
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', function () {
		const modal = document.getElementById('pricing-modal');
		document.addEventListener('keydown', function (e) {
			if (e.key === 'Escape' && modal.style.display === 'flex') {
				modal.style.display = 'none';
			}
		});
	});
</script>